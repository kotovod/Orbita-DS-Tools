# История изменений

## [Исправление] - 2025-11-16

### Исправлена проблема с переменными, скрытыми от публикации

**Проблема:**
Плагин не мог проставлять переменные, которые были скрыты от публикации (`hiddenFromPublishing: true`). Это происходило потому, что функция Figma API `importVariableByKeyAsync()` не может импортировать скрытые переменные из библиотек.

**Решение:**
Теперь плагин:
1. Сохраняет не только `key`, но и `id` каждой переменной при импорте
2. При применении переменной сначала ищет её среди локальных переменных (по `id`)
3. Только если переменная не найдена локально, пытается импортировать её по `key`

**Изменения в коде:**
- Добавлено поле `id` в сохраняемые данные переменных (числовых и цветовых)
- Создана новая функция `getOrImportVariable()`, которая реализует логику поиска/импорта
- Обновлены функции `fixColorError()` и `fixError()` для использования новой логики
- Обновлены функции `collectVariablesFromGroup()` и `collectColorVariablesFromGroup()` для сохранения `id`

**Результат:**
Теперь можно успешно применять переменные, скрытые от публикации, если они находятся в текущем файле (локально).

### Технические детали

#### Новая функция `getOrImportVariable(variableData)`

Эта функция принимает объект с данными переменной и:
1. Проверяет наличие `id` и пытается получить локальную переменную через `figma.variables.getVariableById()`
2. Если локально не найдена, пытается импортировать через `figma.variables.importVariableByKeyAsync()`
3. Возвращает найденную переменную или `null`

#### Обновленная структура данных переменных

**Числовые переменные:**
```javascript
{
  value: 8,
  key: "...",
  id: "...",  // НОВОЕ
  scopes: ["GAP", "WIDTH_HEIGHT"],
  hiddenFromPublishing: false
}
```

**Цветовые переменные:**
```javascript
{
  key: "...",
  id: "...",  // НОВОЕ
  scopes: ["FRAME_FILL", "SHAPE_FILL"],
  modes: {
    "Light": "#FFFFFF",
    "Dark": "#000000"
  },
  hiddenFromPublishing: false
}
```

### Совместимость

Изменения обратно совместимы:
- Если в старых данных нет `id`, плагин попытается импортировать по `key`
- Для новых данных будет использоваться сначала локальный поиск, затем импорт

### Рекомендации

Для получения всех преимуществ исправления:
1. Откройте файл с дизайн-системой (где определены переменные)
2. Выполните импорт переменных заново через плагин
3. Теперь можно применять как опубликованные, так и скрытые переменные


