# ✅ Исправление: Проверка скрытых объектов

## Проблема

Ранее валидатор проверял только свойство `visible` самого объекта, но не учитывал родителей. Из-за этого:
- Instance внутри скрытого Frame всё равно попадали в проверку
- Элементы внутри скрытых групп тоже проверялись

В Figma когда вы скрываете родительский объект через иконку глаза, все его дети становятся невидимыми, даже если у них `visible = true`.

## Решение

Добавлена функция `isNodeOrParentHidden()`, которая проходит по всей иерархии от объекта до корня (PAGE) и проверяет каждого родителя.

```javascript
function isNodeOrParentHidden(node) {
  let currentNode = node;
  
  while (currentNode) {
    if ('visible' in currentNode && currentNode.visible === false) {
      return true; // Нашли скрытого родителя
    }
    if (currentNode.type === 'PAGE' || !currentNode.parent) {
      break;
    }
    currentNode = currentNode.parent; // Идём выше по иерархии
  }
  
  return false;
}
```

## Как это работает

### До исправления:
```
Frame (visible = false) ← скрыт
  └─ Instance (visible = true) ← ПРОВЕРЯЛСЯ ❌
       └─ Rectangle (visible = true) ← ПРОВЕРЯЛСЯ ❌
```

### После исправления:
```
Frame (visible = false) ← скрыт
  └─ Instance (visible = true) ← ПРОПУЩЕН ✅
       └─ Rectangle (visible = true) ← ПРОПУЩЕН ✅
```

## Как проверить

1. **Создайте тестовый Frame:**
   - Добавьте в него несколько элементов
   - У элементов уберите токены (чтобы были ошибки)

2. **Скройте Frame:**
   - Нажмите на иконку глаза в панели слоёв
   - Frame и все дети станут полупрозрачными в панели

3. **Запустите DSV проверку:**
   - Откройте плагин → Validator
   - Нажмите "Проверить"
   - Убедитесь что галочка "Пропускать скрытые объекты" включена

4. **Результат:**
   - ✅ Скрытый Frame и все его дети **НЕ должны** появиться в списке проблем
   - ✅ В консоли должно быть: `DSV: Пропущен скрытый объект: [имя] (тип)`

5. **Проверка отключения:**
   - Снимите галочку "Пропускать скрытые объекты"
   - Запустите проверку снова
   - Теперь элементы **должны появиться** в списке проблем

## Теперь правильно пропускаются:

✅ Скрытые Frame  
✅ Скрытые Group  
✅ Instance внутри скрытых объектов  
✅ Элементы на любом уровне вложенности в скрытых родителях  
✅ Компоненты и их содержимое, если родитель скрыт  

## Настройка всегда включена по умолчанию

При открытии плагина настройка **"Пропускать скрытые объекты"** автоматически включена. Это логично, так как скрытые элементы обычно не нужно валидировать.

